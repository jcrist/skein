
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Remote IPython Kernel &#8212; Skein 0.4.0+1.g2e0b735 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Jupyter Notebook Server" href="recipes-jupyter-notebook.html" />
    <link rel="prev" title="Recipes" href="recipes.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="remote-ipython-kernel">
<h1>Remote IPython Kernel<a class="headerlink" href="#remote-ipython-kernel" title="Permalink to this headline">¶</a></h1>
<p>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">skein.recipes.ipython_kernel</span></code> module provides a command-line recipe
for starting a remote IPython kernel on a YARN container. The intended use is
to execute the module in a service, using the command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python -m skein.recipes.ipython_kernel
</pre></div>
</div>
<p>The executing Python environment must contain the following dependencies to
work properly:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">skein</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ipykernel</span></code></li>
</ul>
<p>After launching the service, the kernel connection information will be stored
in the <a class="reference external" href="key-value-store.html">key-value store</a> under the key
<code class="docutils literal notranslate"><span class="pre">'ipython.kernel.info'</span></code>. This key name is configurable with the command-line
flag <code class="docutils literal notranslate"><span class="pre">--kernel-info-key</span></code>.</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Here we provide a complete walkthrough of launching and connecting to a remote
IPython kernel. This example assumes you’re logged into and running on an edge
node.</p>
<div class="section" id="kinit-optional">
<h3>Kinit (optional)<a class="headerlink" href="#kinit-optional" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="quickstart.html#quickstart-kinit"><span class="std std-ref">Kinit (optional)</span></a>.</p>
</div>
<div class="section" id="start-the-skein-daemon-optional">
<h3>Start the Skein Daemon (optional)<a class="headerlink" href="#start-the-skein-daemon-optional" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="quickstart.html#quickstart-skein-daemon"><span class="std std-ref">Start the Skein Daemon (optional)</span></a>.</p>
</div>
<div class="section" id="package-the-python-environment">
<h3>Package the Python Environment<a class="headerlink" href="#package-the-python-environment" title="Permalink to this headline">¶</a></h3>
<p>To distribute Python environments we’ll make use of <a class="reference external" href="https://conda.github.io/conda-pack/">conda-pack</a>, a tool for packaging and distributing
conda environments. As mentioned above, we need to make sure we have the
following packages installed in the remote environment:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">skein</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ipykernel</span></code></li>
</ul>
<p>we’ll also install <code class="docutils literal notranslate"><span class="pre">numpy</span></code> to have an example library for doing some
computation, and <code class="docutils literal notranslate"><span class="pre">jupyter_console</span></code> to have a way to connect to the remote
kernel (note that this is only needed on the client machine, but we’ll install
it on both for simplicity).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Create a new demo environment <span class="o">(</span>output trimmed <span class="k">for</span> brevity<span class="o">)</span>
<span class="gp">$</span> conda create -n ipython-demo
<span class="go">...</span>

<span class="gp">#</span> Activate the environment
<span class="gp">$</span> conda activate ipython-demo

<span class="gp">#</span> Install the needed packages <span class="o">(</span>output trimmed <span class="k">for</span> brevity<span class="o">)</span>
<span class="gp">$</span> conda install conda-pack skein ipykernel numpy jupyter_console -c conda-forge
<span class="go">...</span>

<span class="gp">#</span> Package the environment into environment.tar.gz
<span class="gp">$</span> conda pack -o environment.tar.gz
<span class="go">Collecting packages...</span>
<span class="go">Packing environment at &#39;/home/jcrist/miniconda/envs/ipython-demo&#39; to &#39;environment.tar.gz&#39;</span>
<span class="go">[########################################] | 100% Completed | 35.3s</span>
</pre></div>
</div>
</div>
<div class="section" id="write-the-application-specification">
<h3>Write the Application Specification<a class="headerlink" href="#write-the-application-specification" title="Permalink to this headline">¶</a></h3>
<p>Next we need to write the application specification. For more information see
the <a class="reference external" href="specification.html">specification docs</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># stored in ipython-demo.yaml</span>

<span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ipython-demo</span>

<span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">ipython</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1 GiB</span>
      <span class="l l-Scalar l-Scalar-Plain">vcores</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="l l-Scalar l-Scalar-Plain">files</span><span class="p p-Indicator">:</span>
      <span class="c1"># Distribute the bundled environment as part of the application.</span>
      <span class="c1"># This will be automatically extracted by YARN to the directory</span>
      <span class="c1"># ``environment`` during resource localization.</span>
      <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">environment.tar.gz</span>
    <span class="l l-Scalar l-Scalar-Plain">commands</span><span class="p p-Indicator">:</span>
      <span class="c1"># Activate our environment</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">source environment/bin/activate</span>
      <span class="c1"># Start the remote ipython kernel</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python -m skein.recipes.ipython_kernel</span>
</pre></div>
</div>
</div>
<div class="section" id="start-the-remote-ipython-kernel">
<h3>Start the Remote IPython Kernel<a class="headerlink" href="#start-the-remote-ipython-kernel" title="Permalink to this headline">¶</a></h3>
<p>Now we have everything needed to start the remote IPython kernel. The following
bash command starts the application and stores the application id in the
environment variable <code class="docutils literal notranslate"><span class="pre">APPID</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nv">APPID</span><span class="o">=</span><span class="sb">`</span>skein application submit ipython-demo.yaml<span class="sb">`</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieve-the-kernel-information">
<h3>Retrieve the Kernel Information<a class="headerlink" href="#retrieve-the-kernel-information" title="Permalink to this headline">¶</a></h3>
<p>To connect to a remote kernel, Jupyter requires information usually stored in a
<code class="docutils literal notranslate"><span class="pre">kernel.json</span></code> file. As mentioned above, the recipe provided in
<code class="xref py py-mod docutils literal notranslate"><span class="pre">skein.recipes.ipython_kernel</span></code> stores this information in the key
<code class="docutils literal notranslate"><span class="pre">'ipython.kernel.info'</span></code>. We can retrieve this information and store it in a
file using the following bash command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> skein kv get <span class="nv">$APPID</span> --key ipython.kernel.info --wait &gt; kernel.json
</pre></div>
</div>
</div>
<div class="section" id="connect-to-the-remote-ipython-kernel">
<h3>Connect to the Remote IPython Kernel<a class="headerlink" href="#connect-to-the-remote-ipython-kernel" title="Permalink to this headline">¶</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">console</span></code> and the <code class="docutils literal notranslate"><span class="pre">kernel.json</span></code> file, we can connect to the
remote kernel.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> jupyter console --existing kernel.json
<span class="go">Jupyter console 5.2.0</span>

<span class="go">Python 3.6.6 | packaged by conda-forge | (default, Jul 26 2018, 09:53:17)</span>
<span class="go">Type &#39;copyright&#39;, &#39;credits&#39; or &#39;license&#39; for more information</span>
<span class="go">IPython 6.5.0 -- An enhanced Interactive Python. Type &#39;?&#39; for help.</span>


<span class="go">In [1]: import numpy as np  # can import distributed libraries</span>

<span class="go">In [2]: np.sum([1, 2, 3])</span>
<span class="go">Out[2]: 6</span>

<span class="go">In [3]: # ls shows the files on the remote container, not the local files</span>

<span class="go">In [4]: ls</span>
<span class="go">container_tokens                        environment@</span>
<span class="go">default_container_executor_session.sh*  launch_container.sh*</span>
<span class="go">default_container_executor.sh*          tmp/</span>

<span class="go">In [5]: # exit shuts down the application</span>

<span class="go">In [6]: exit</span>
<span class="go">Shutting down kernel</span>
</pre></div>
</div>
</div>
<div class="section" id="confirm-that-the-application-completed">
<h3>Confirm that the Application Completed<a class="headerlink" href="#confirm-that-the-application-completed" title="Permalink to this headline">¶</a></h3>
<p>We can check that application shutdown properly using <code class="docutils literal notranslate"><span class="pre">skein</span> <span class="pre">application</span> <span class="pre">status</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> skein application status <span class="nv">$APPID</span>
<span class="go">APPLICATION_ID                    NAME            STATE       STATUS       CONTAINERS    VCORES    MEMORY    RUNTIME</span>
<span class="go">application_1533143063639_0017    ipython-demo    FINISHED    SUCCEEDED    0             0         0         2m</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo.svg" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">A tool and library for easily deploying applications on Apache YARN</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jcrist&repo=skein&type=watch&count=False&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/jcrist/skein">
    <img
        alt="https://secure.travis-ci.org/jcrist/skein.svg?branch=master"
        src="https://secure.travis-ci.org/jcrist/skein.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="specification.html">Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributing-files.html">Distributing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="key-value-store.html">Key-Value Store</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-ui.html">Web UI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="recipes.html">Recipes</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Remote IPython Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="recipes-jupyter-notebook.html">Jupyter Notebook Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="develop.html">Development</a></li>
</ul>

<h3>Need help?</h3>

<p>
  Open an issue in the <a href="https://github.com/jcrist/skein/issues">issue tracker</a>.
</p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Jim Crist.
      
      |
      <a href="_sources/recipes-ipython-kernel.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Specification &#8212; Skein 0.5.1+5.g28f0a6d documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Distributing Files" href="distributing-files.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="specification">
<h1>Specification<a class="headerlink" href="#specification" title="Permalink to this headline">¶</a></h1>
<p>Skein uses a declarative api for creating applications. The application may be
specificed as a YAML or JSON document, or via the <a class="reference external" href="api.html#application-specification">Python API</a>.  Here we describe the pieces of an
application specification in detail.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#specification-components" id="id7">Specification Components</a><ul>
<li><a class="reference internal" href="#top-level-fields" id="id8">Top-Level Fields</a><ul>
<li><a class="reference internal" href="#name" id="id9"><code class="docutils literal notranslate"><span class="pre">name</span></code></a></li>
<li><a class="reference internal" href="#queue" id="id10"><code class="docutils literal notranslate"><span class="pre">queue</span></code></a></li>
<li><a class="reference internal" href="#user" id="id11"><code class="docutils literal notranslate"><span class="pre">user</span></code></a></li>
<li><a class="reference internal" href="#node-label" id="id12"><code class="docutils literal notranslate"><span class="pre">node_label</span></code></a></li>
<li><a class="reference internal" href="#max-attempts" id="id13"><code class="docutils literal notranslate"><span class="pre">max_attempts</span></code></a></li>
<li><a class="reference internal" href="#tags" id="id14"><code class="docutils literal notranslate"><span class="pre">tags</span></code></a></li>
<li><a class="reference internal" href="#file-systems" id="id15"><code class="docutils literal notranslate"><span class="pre">file_systems</span></code></a></li>
<li><a class="reference internal" href="#acls" id="id16"><code class="docutils literal notranslate"><span class="pre">acls</span></code></a></li>
<li><a class="reference internal" href="#master" id="id17"><code class="docutils literal notranslate"><span class="pre">master</span></code></a></li>
<li><a class="reference internal" href="#services" id="id18"><code class="docutils literal notranslate"><span class="pre">services</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification-master" id="id19">Master</a><ul>
<li><a class="reference internal" href="#resources" id="id20"><code class="docutils literal notranslate"><span class="pre">resources</span></code></a></li>
<li><a class="reference internal" href="#script" id="id21"><code class="docutils literal notranslate"><span class="pre">script</span></code></a></li>
<li><a class="reference internal" href="#files" id="id22"><code class="docutils literal notranslate"><span class="pre">files</span></code></a></li>
<li><a class="reference internal" href="#env" id="id23"><code class="docutils literal notranslate"><span class="pre">env</span></code></a></li>
<li><a class="reference internal" href="#log-level" id="id24"><code class="docutils literal notranslate"><span class="pre">log_level</span></code></a></li>
<li><a class="reference internal" href="#log-config" id="id25"><code class="docutils literal notranslate"><span class="pre">log_config</span></code></a></li>
<li><a class="reference internal" href="#security" id="id26"><code class="docutils literal notranslate"><span class="pre">security</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#service" id="id27">Service</a><ul>
<li><a class="reference internal" href="#id2" id="id28"><code class="docutils literal notranslate"><span class="pre">resources</span></code></a></li>
<li><a class="reference internal" href="#id3" id="id29"><code class="docutils literal notranslate"><span class="pre">script</span></code></a></li>
<li><a class="reference internal" href="#id4" id="id30"><code class="docutils literal notranslate"><span class="pre">files</span></code></a></li>
<li><a class="reference internal" href="#id5" id="id31"><code class="docutils literal notranslate"><span class="pre">env</span></code></a></li>
<li><a class="reference internal" href="#instances" id="id32"><code class="docutils literal notranslate"><span class="pre">instances</span></code></a></li>
<li><a class="reference internal" href="#depends" id="id33"><code class="docutils literal notranslate"><span class="pre">depends</span></code></a></li>
<li><a class="reference internal" href="#max-restarts" id="id34"><code class="docutils literal notranslate"><span class="pre">max_restarts</span></code></a></li>
<li><a class="reference internal" href="#allow-failures" id="id35"><code class="docutils literal notranslate"><span class="pre">allow_failures</span></code></a></li>
<li><a class="reference internal" href="#id6" id="id36"><code class="docutils literal notranslate"><span class="pre">node_label</span></code></a></li>
<li><a class="reference internal" href="#nodes" id="id37"><code class="docutils literal notranslate"><span class="pre">nodes</span></code></a></li>
<li><a class="reference internal" href="#racks" id="id38"><code class="docutils literal notranslate"><span class="pre">racks</span></code></a></li>
<li><a class="reference internal" href="#relax-locality" id="id39"><code class="docutils literal notranslate"><span class="pre">relax_locality</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#example" id="id40">Example</a></li>
<li><a class="reference internal" href="#python-api-example" id="id41">Python API Example</a></li>
</ul>
</div>
<div class="section" id="specification-components">
<h2><a class="toc-backref" href="#id7">Specification Components</a><a class="headerlink" href="#specification-components" title="Permalink to this headline">¶</a></h2>
<div class="section" id="top-level-fields">
<h3><a class="toc-backref" href="#id8">Top-Level Fields</a><a class="headerlink" href="#top-level-fields" title="Permalink to this headline">¶</a></h3>
<p>At the top-level, a specification starts with an <a class="reference internal" href="api.html#skein.ApplicationSpec" title="skein.ApplicationSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ApplicationSpec</span></code></a>.
This takes the following fields:</p>
<div class="section" id="name">
<h4><a class="toc-backref" href="#id9"><code class="docutils literal notranslate"><span class="pre">name</span></code></a><a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h4>
<p>The name of the application. Optional, defaults to <code class="docutils literal notranslate"><span class="pre">skein</span></code>.</p>
</div>
<div class="section" id="queue">
<h4><a class="toc-backref" href="#id10"><code class="docutils literal notranslate"><span class="pre">queue</span></code></a><a class="headerlink" href="#queue" title="Permalink to this headline">¶</a></h4>
<p>The queue to submit the application to. Optional, defaults to <code class="docutils literal notranslate"><span class="pre">default</span></code>.</p>
</div>
<div class="section" id="user">
<h4><a class="toc-backref" href="#id11"><code class="docutils literal notranslate"><span class="pre">user</span></code></a><a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h4>
<p>The username to submit the application as. Requires that the current user
have permission to proxy as this username. Optional, defaults to the
current user’s username. In most cases the default is what you want.</p>
</div>
<div class="section" id="node-label">
<h4><a class="toc-backref" href="#id12"><code class="docutils literal notranslate"><span class="pre">node_label</span></code></a><a class="headerlink" href="#node-label" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/NodeLabel.html">node_label</a>
to request for all containers in this application. Services can override this
value by setting <code class="docutils literal notranslate"><span class="pre">node_label</span></code> on the service directly. Default is no label.</p>
</div>
<div class="section" id="max-attempts">
<h4><a class="toc-backref" href="#id13"><code class="docutils literal notranslate"><span class="pre">max_attempts</span></code></a><a class="headerlink" href="#max-attempts" title="Permalink to this headline">¶</a></h4>
<p>The maximum number of submission attempts before marking the application as
failed. Note that this only considers failures of the Application Master
during startup. Optional, default is 1 (recommended).</p>
</div>
<div class="section" id="tags">
<h4><a class="toc-backref" href="#id14"><code class="docutils literal notranslate"><span class="pre">tags</span></code></a><a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h4>
<p>A list of strings to use as tags for this application. Optional.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tags:
  - my-tag
  - my-other-tag
</pre></div>
</div>
</div>
<div class="section" id="file-systems">
<h4><a class="toc-backref" href="#id15"><code class="docutils literal notranslate"><span class="pre">file_systems</span></code></a><a class="headerlink" href="#file-systems" title="Permalink to this headline">¶</a></h4>
<p>A list of Hadoop file systems to acquire delegation tokens for. A token is
always acquired for the default filesystem (<code class="docutils literal notranslate"><span class="pre">fs.defaultFS</span></code> in
<code class="docutils literal notranslate"><span class="pre">core-site.xml</span></code>). In many cases the default is sufficient. Optional.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>file_systems:
  - hdfs://nn1.com:8032
  - hdfs://nn2.com:8032
  - webhdfs://nn3.com:50070
</pre></div>
</div>
</div>
<div class="section" id="acls">
<span id="specification-acls"></span><h4><a class="toc-backref" href="#id16"><code class="docutils literal notranslate"><span class="pre">acls</span></code></a><a class="headerlink" href="#acls" title="Permalink to this headline">¶</a></h4>
<p>Configures the application-level Access Control Lists (ACLs). Optional,
defaults to no ACLs.</p>
<p>The following access types are supported:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">VIEW</span></code> : view application details</li>
<li><code class="docutils literal notranslate"><span class="pre">MODIFY</span></code> : modify the application via YARN (e.g. killing the application)</li>
<li><code class="docutils literal notranslate"><span class="pre">UI</span></code> : access the application Web UI</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">VIEW</span></code> and <code class="docutils literal notranslate"><span class="pre">MODIFY</span></code> access types are handled by YARN directly;
permissions for these can be set by users and/or groups. Authorizing <code class="docutils literal notranslate"><span class="pre">UI</span></code>
access is handled by Skein internally, and only user-level access control is
supported.</p>
<p>The application owner (the user who submitted the application) will always
have permission for all access types.</p>
<p>By default, ACLs are disabled - to enable, set <code class="docutils literal notranslate"><span class="pre">enable:</span> <span class="pre">True</span></code>. If enabled,
access is restricted only to the application owner by default - add
users/groups to the access types you wish to expand to other users. You can
use the wildcard character <code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code> to enable access for all users. Here we
give view access to all users:</p>
<p>Supported subfields are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">enable</span></code>: whether to enable ACLs for this application. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">view_users</span></code>: users to give <code class="docutils literal notranslate"><span class="pre">VIEW</span></code> access. Default is <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">view_groups</span></code>: groups to give <code class="docutils literal notranslate"><span class="pre">VIEW</span></code> access. Default is <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">modify_users</span></code>: users to give <code class="docutils literal notranslate"><span class="pre">MODIFY</span></code> access. Default is <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">modify_groups</span></code>: groups to give <code class="docutils literal notranslate"><span class="pre">MODIFY</span></code> access. Default is <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">ui_users</span></code>: users to give <code class="docutils literal notranslate"><span class="pre">UI</span></code> access. Default is <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</li>
</ul>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>acls:
  enable: True    # Enable ACLs. Without this ACLs will be ignored.

  ui_users:
    - &quot;*&quot;           # Give all users access to the Web UI

  view_users:
    - nancy         # Give nancy view access

  # The application owner always has access to all access types. Since
  # `modify_users`/`modify_groups` are unchanged, only the owner has modify
  # access.
</pre></div>
</div>
<p>For more information on ACLs see:</p>
<ul class="simple">
<li>Cloudera’s <a class="reference external" href="https://www.cloudera.com/documentation/enterprise/6/6.0/topics/cm_mc_yarn_service1.html">documentation on YARN ACLs</a></li>
<li>The <a class="reference internal" href="api.html#skein.ACLs" title="skein.ACLs"><code class="xref py py-class docutils literal notranslate"><span class="pre">ACLs</span></code></a> docstring</li>
</ul>
</div>
<div class="section" id="master">
<h4><a class="toc-backref" href="#id17"><code class="docutils literal notranslate"><span class="pre">master</span></code></a><a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<p>A <a class="reference internal" href="api.html#skein.Master" title="skein.Master"><code class="xref py py-class docutils literal notranslate"><span class="pre">Master</span></code></a> object, configuring the Application Master. Optional, see
<a class="reference internal" href="#specification-master">specification-master</a> for more information.</p>
</div>
<div class="section" id="services">
<h4><a class="toc-backref" href="#id18"><code class="docutils literal notranslate"><span class="pre">services</span></code></a><a class="headerlink" href="#services" title="Permalink to this headline">¶</a></h4>
<p>A dict of service-name to <a class="reference internal" href="api.html#skein.Service" title="skein.Service"><code class="xref py py-class docutils literal notranslate"><span class="pre">Service</span></code></a>. Optional, see <a class="reference internal" href="#service">Service</a> for more
information.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>services:
  my_service:
    ...
</pre></div>
</div>
</div>
</div>
<div class="section" id="specification-master">
<span id="id1"></span><h3><a class="toc-backref" href="#id19">Master</a><a class="headerlink" href="#specification-master" title="Permalink to this headline">¶</a></h3>
<p>All applications start with a single process called an <em>Application Master</em>.
This process is responsible for starting and managing any additional containers
during the lifetime of the application.</p>
<p>In Skein, the Application Master is the Java process that interprets the
specification, and manages any additional services that specification contains.
It also allows for <em>optionally</em> running a single user-defined process, referred
to in Skein as the <em>application driver</em>. If an application driver is specified,
the application will terminate when that process exits, regardless if other
services have yet to complete.</p>
<p>The <a class="reference internal" href="api.html#skein.Master" title="skein.Master"><code class="xref py py-class docutils literal notranslate"><span class="pre">Master</span></code></a> object allows for configuring the Application Master Java
process, as well as the optional user-defined application driver. Supported
subfields are:</p>
<div class="section" id="resources">
<span id="specification-resources"></span><h4><a class="toc-backref" href="#id20"><code class="docutils literal notranslate"><span class="pre">resources</span></code></a><a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h4>
<p>The memory and cpu requirements for the Application Master. Takes the following
fields:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">memory</span></code></p>
<p>The amount of memory to request. Can be either a string with units (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;5</span>
<span class="pre">GiB&quot;</span></code>), or numeric. If numeric, specifies the amount of memory in <em>MiB</em>.
Note that the units are in mebibytes (MiB) <em>not</em> megabytes (MB) - the former
being binary based (1024 MiB in a GiB), the latter being decimal based (1000
MB in a GB). See <a class="reference external" href="https://en.wikipedia.org/wiki/Mebibyte">here</a> for more
information on this distinction.</p>
<p>Requests smaller than the minimum allocation will receive the minimum
allocation (1024 MiB by default). Requests larger than the maximum allocation
will error on application submission.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">vcores</span></code></p>
<p>The number of virtual cores to request. Depending on your system
configuration one virtual core may map to a single actual core, or a fraction
of a core. Requests larger than the maximum allocation will error on
application submission.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>master:
  resources:
    memory: 2 GiB
    vcores: 2
</pre></div>
</div>
</div>
<div class="section" id="script">
<h4><a class="toc-backref" href="#id21"><code class="docutils literal notranslate"><span class="pre">script</span></code></a><a class="headerlink" href="#script" title="Permalink to this headline">¶</a></h4>
<p>A bash script to run the <em>application driver</em>. Optional.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>master:
  script: |
    echo &quot;Run this first&quot;
    echo &quot;Run this next&quot;
</pre></div>
</div>
</div>
<div class="section" id="files">
<span id="specification-files"></span><h4><a class="toc-backref" href="#id22"><code class="docutils literal notranslate"><span class="pre">files</span></code></a><a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h4>
<p>Any files or archives needed to distribute to this container. A mapping of
destination relative paths to <a class="reference internal" href="api.html#skein.File" title="skein.File"><code class="xref py py-class docutils literal notranslate"><span class="pre">File</span></code></a> or <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code> objects describing
the sources for these paths. <a class="reference internal" href="api.html#skein.File" title="skein.File"><code class="xref py py-class docutils literal notranslate"><span class="pre">File</span></code></a> objects are described in more detail
below.  Each <a class="reference internal" href="api.html#skein.File" title="skein.File"><code class="xref py py-class docutils literal notranslate"><span class="pre">File</span></code></a> object takes the following fields:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">source</span></code></p>
<p>The path to the file/archive. If no scheme is specified, the path is assumed
to be on the local filesystem (<code class="docutils literal notranslate"><span class="pre">file://</span></code> scheme). Relative paths are
supported, and are taken relative to the location of the specification file.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">type</span></code></p>
<p>The type of file to distribute – either <code class="docutils literal notranslate"><span class="pre">archive</span></code> or <code class="docutils literal notranslate"><span class="pre">file</span></code>.  Archive’s
are automatically extracted by yarn into a directory with the same name as
their destination (only <code class="docutils literal notranslate"><span class="pre">.zip</span></code>, <code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code>, and <code class="docutils literal notranslate"><span class="pre">.tgz</span></code> supported).
Optional; by default the type is inferred from the file extension.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">visibility</span></code></p>
<p>The resource visibility. Describes how resources are shared between
applications. Valid values are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">application</span></code> – Shared among containers of the same application on the node.</li>
<li><code class="docutils literal notranslate"><span class="pre">private</span></code> – Shared among all applications of the same user on the node.</li>
<li><code class="docutils literal notranslate"><span class="pre">public</span></code> – Shared by all users on the node.</li>
</ul>
<p>Optional, default is <code class="docutils literal notranslate"><span class="pre">application</span></code>. In most cases the default is what you
want.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">size</span></code></p>
<p>The resource size in bytes. Optional; if not provided will be determined by
the file system. In most cases the default is what you want.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">timestamp</span></code></p>
<p>The time the resource was last modified. Optional; if not provided will be
determined by the file system. In most cases the default is what you want.</p>
</li>
</ul>
<p>As a shorthand, values may be the source path instead of a <a class="reference internal" href="api.html#skein.File" title="skein.File"><code class="xref py py-class docutils literal notranslate"><span class="pre">File</span></code></a>
object.</p>
<p>For more information see <a class="reference internal" href="distributing-files.html"><span class="doc">Distributing Files</span></a>.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>master:
  files:
    # /local/path/to/file.zip will be uploaded to hdfs, and extracted
    # into the directory path_on_container
    path_on_container:
      source: /local/path/to/file.zip
      type: archive

    # Can also specify only the source path - missing fields are inferred
    script_path.py: /path/to/script.py

    # Files on remote filesystems can be used by specifying the scheme.
    script2_path.py: hdfs:///remote/path/to/script2.py
</pre></div>
</div>
</div>
<div class="section" id="env">
<h4><a class="toc-backref" href="#id23"><code class="docutils literal notranslate"><span class="pre">env</span></code></a><a class="headerlink" href="#env" title="Permalink to this headline">¶</a></h4>
<p>A mapping of environment variables to set in this container. Optional.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>master:
  env:
    ENV1: VAL1
    ENV2: VAL2
</pre></div>
</div>
</div>
<div class="section" id="log-level">
<h4><a class="toc-backref" href="#id24"><code class="docutils literal notranslate"><span class="pre">log_level</span></code></a><a class="headerlink" href="#log-level" title="Permalink to this headline">¶</a></h4>
<p>The Application Master log level. Possible values are (from most to least
verbose): <code class="docutils literal notranslate"><span class="pre">all</span></code>, <code class="docutils literal notranslate"><span class="pre">trace</span></code>, <code class="docutils literal notranslate"><span class="pre">debug</span></code>, <code class="docutils literal notranslate"><span class="pre">info</span></code>, <code class="docutils literal notranslate"><span class="pre">warn</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code>,
<code class="docutils literal notranslate"><span class="pre">fatal</span></code> or <code class="docutils literal notranslate"><span class="pre">off</span></code>. Note that this sets the <code class="docutils literal notranslate"><span class="pre">skein.log.level</span></code> system
property, which is used in the default <code class="docutils literal notranslate"><span class="pre">log4j.properties</span></code> file - if you
provide your own <code class="docutils literal notranslate"><span class="pre">log4j.properties</span></code> file this field may have no effect.
Optional, the default is <code class="docutils literal notranslate"><span class="pre">info</span></code>.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>master:
  log_level: debug
</pre></div>
</div>
</div>
<div class="section" id="log-config">
<h4><a class="toc-backref" href="#id25"><code class="docutils literal notranslate"><span class="pre">log_config</span></code></a><a class="headerlink" href="#log-config" title="Permalink to this headline">¶</a></h4>
<p>A path to a custom <code class="docutils literal notranslate"><span class="pre">log4j.properties</span></code> file. Could be local or on a remote
filesystem. If not provided, a default logging configuration is used. See the
<a class="reference external" href="https://logging.apache.org/log4j/1.2/">Log4j documentation</a> for more
information. Optional.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>master:
  log_config: path/to/my/log4j.properties
</pre></div>
</div>
</div>
<div class="section" id="security">
<h4><a class="toc-backref" href="#id26"><code class="docutils literal notranslate"><span class="pre">security</span></code></a><a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h4>
<p>Security configuration for the Application Master. By default the application
master will use the same security credentials as the driver that launched it.
To override, provide a mapping of specifying the locations of <code class="docutils literal notranslate"><span class="pre">cert_file</span></code> and
<code class="docutils literal notranslate"><span class="pre">key_file</span></code>. See the <a class="reference internal" href="api.html#skein.Security" title="skein.Security"><code class="xref py py-class docutils literal notranslate"><span class="pre">Security</span></code></a> docstring for more information.
Optional, the default is usually sufficient.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>master:
  security:
    cert_file: path/to/my/cert_file.crt
    key_file: path/to/my/key_file.pem
</pre></div>
</div>
</div>
</div>
<div class="section" id="service">
<h3><a class="toc-backref" href="#id27">Service</a><a class="headerlink" href="#service" title="Permalink to this headline">¶</a></h3>
<p>Any additional containers needed by an application can be described a
<a class="reference internal" href="api.html#skein.Service" title="skein.Service"><code class="xref py py-class docutils literal notranslate"><span class="pre">Service</span></code></a>.  Services specify how to launch an executable, as well as how
that executable should be managed over the course of the application. A service
may also have multiple instances, each running in their own YARN container. A
service description takes the following fields:</p>
<div class="section" id="id2">
<h4><a class="toc-backref" href="#id28"><code class="docutils literal notranslate"><span class="pre">resources</span></code></a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>The memory and cpu requirements for a single instance of the service. Same as
the <code class="docutils literal notranslate"><span class="pre">resources</span></code> field in <code class="docutils literal notranslate"><span class="pre">master</span></code> <a class="reference internal" href="#specification-resources"><span class="std std-ref">described above</span></a>.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>services:
  my_service:
    resources:
      memory: 2 GiB
      vcores: 2
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4><a class="toc-backref" href="#id29"><code class="docutils literal notranslate"><span class="pre">script</span></code></a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>A bash script to run the service. Required.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>services:
  my_service:
    script: |
      echo &quot;Run this first&quot;
      echo &quot;Run this next&quot;
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id30"><code class="docutils literal notranslate"><span class="pre">files</span></code></a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Any files or archives needed to run the service. Same as the <code class="docutils literal notranslate"><span class="pre">files</span></code> field in
<code class="docutils literal notranslate"><span class="pre">master</span></code> <a class="reference internal" href="#specification-files"><span class="std std-ref">described above</span></a>.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>services:
  my_service:
    files:
      # /local/path/to/file.zip will be uploaded to hdfs, and extracted
      # into the directory path_on_container
      path_on_container:
        source: /local/path/to/file.zip
        type: archive

      # Can also specify only the source path - missing fields are inferred
      script_path.py: /path/to/script.py

      # Files on remote filesystems can be used by specifying the scheme.
      script2_path.py: hdfs:///remote/path/to/script2.py
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4><a class="toc-backref" href="#id31"><code class="docutils literal notranslate"><span class="pre">env</span></code></a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>A mapping of environment variables needed to run the service. Optional.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>services:
  my_service:
    env:
      ENV1: VAL1
      ENV2: VAL2
</pre></div>
</div>
</div>
<div class="section" id="instances">
<h4><a class="toc-backref" href="#id32"><code class="docutils literal notranslate"><span class="pre">instances</span></code></a><a class="headerlink" href="#instances" title="Permalink to this headline">¶</a></h4>
<p>The number of instances to create on startup. Must be &gt;= 0. After startup
additional instances may be created by the <a class="reference internal" href="api.html#skein.ApplicationClient" title="skein.ApplicationClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">ApplicationClient</span></code></a>.
Optional, default is 1.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>services:
  my_service:
    instances: 4  # Start 4 instances
</pre></div>
</div>
</div>
<div class="section" id="depends">
<h4><a class="toc-backref" href="#id33"><code class="docutils literal notranslate"><span class="pre">depends</span></code></a><a class="headerlink" href="#depends" title="Permalink to this headline">¶</a></h4>
<p>A list of service names that this service depends on. The service will only be
started after all its dependencies have been started. Optional.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>services:
  starts_first:
    ...
  starts_second:
    depends:
      - starts_first
</pre></div>
</div>
</div>
<div class="section" id="max-restarts">
<h4><a class="toc-backref" href="#id34"><code class="docutils literal notranslate"><span class="pre">max_restarts</span></code></a><a class="headerlink" href="#max-restarts" title="Permalink to this headline">¶</a></h4>
<p>The maximum number of restarts allowed for this service. Must be &gt;= -1. On
failure, a container will be restarted if the total number of restarts for its
service is &lt; <code class="docutils literal notranslate"><span class="pre">max_restarts</span></code>. Once this limit is exceeded, the service is
marked as failed and the application will be terminated. Set to -1 to always
restart, or 0 to never restart. Optional, default is 0.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>services:
  my_service1:
    max_restarts: -1  # always restart
    ...

  my_service2:
    max_restarts: 0   # never restart
    ...

  my_service3:
    max_restarts: 3   # restart a maximum of 3 times
    ...
</pre></div>
</div>
</div>
<div class="section" id="allow-failures">
<h4><a class="toc-backref" href="#id35"><code class="docutils literal notranslate"><span class="pre">allow_failures</span></code></a><a class="headerlink" href="#allow-failures" title="Permalink to this headline">¶</a></h4>
<p>If False (default), the whole application will shutdown if the number of
failures for this service exceeds <code class="docutils literal notranslate"><span class="pre">max_restarts</span></code>. Set to True to keep the
application running even if the number of failures exceeds this limit.
Optional, default is False.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>services:
  my_service1:
    max_restarts: 0         # Never restart
    allow_failures: True    # Don&#39;t terminate the application on failure
    ...

  my_service2:
    max_restarts: 3         # Restart a maximum of 3 times
    allow_failures: False   # If more than 3 failures, terminate the application
    ...
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id36"><code class="docutils literal notranslate"><span class="pre">node_label</span></code></a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/NodeLabel.html">node_label</a>
to request for all containers in this service. If not set, defaults to the
application-level <code class="docutils literal notranslate"><span class="pre">node_label</span></code> (if set).</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>node_label: mylabel

services:
  my_service1:
    node_label: GPU  # This service will be allocated on &quot;GPU&quot; nodes only.
    ...

  my_service2:
    # node_label is not set, the application label &quot;mylabel&quot; will be used.
    ...
</pre></div>
</div>
</div>
<div class="section" id="nodes">
<h4><a class="toc-backref" href="#id37"><code class="docutils literal notranslate"><span class="pre">nodes</span></code></a><a class="headerlink" href="#nodes" title="Permalink to this headline">¶</a></h4>
<p>A list of node host names to restrict containers for this service to. Optional,
defaults to no node restrictions.</p>
</div>
<div class="section" id="racks">
<h4><a class="toc-backref" href="#id38"><code class="docutils literal notranslate"><span class="pre">racks</span></code></a><a class="headerlink" href="#racks" title="Permalink to this headline">¶</a></h4>
<p>A list of rack names to restrict containers for this service to. The racks
corresponding to any nodes requested will be automatically added to this list.
Optional, defaults to no rack restrictions.</p>
</div>
<div class="section" id="relax-locality">
<h4><a class="toc-backref" href="#id39"><code class="docutils literal notranslate"><span class="pre">relax_locality</span></code></a><a class="headerlink" href="#relax-locality" title="Permalink to this headline">¶</a></h4>
<p>Whether to interpret the <code class="docutils literal notranslate"><span class="pre">nodes</span></code> and <code class="docutils literal notranslate"><span class="pre">racks</span></code> specifications as locality
<em>suggestions</em> whether than <em>requirements</em>. If True, containers for this request
may be assigned on hosts and racks other than the ones explicitly requested. If
False, those restrictions are strictly enforced. Optional, default is False.</p>
<p><strong>Example</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>services:
  my_service1:
    # This service *must* run on either worker1 or worker2
    relax_locality: false
    nodes:
      - worker1
      - worker2

  my_service2:
    # This service is *suggested* to run on either worker1 or worker2,
    # but may run on any node
    relax_locality: true
    nodes:
      - worker1
      - worker2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="example">
<h2><a class="toc-backref" href="#id40">Example</a><a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>An example specification file. This starts a <a class="reference external" href="http://jupyter.org/">jupyter</a>
notebook and a 4 node <a class="reference external" href="http://dask.pydata.org/">dask.distributed</a> cluster.
The example uses <a class="reference external" href="https://github.com/jcrist/conda-pack/">conda-pack</a> to
package and distribute <a class="reference external" href="http://conda.pydata.org/">conda environments</a>, but
applications are free to package files any way they see fit.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>name: dask-with-jupyter
queue: default

master:
  resources:
    memory: 2 GiB
    vcores: 1
  files:
    conda_env: env.tar.gz
    data.csv: hdfs:///path/to/some/data.csv
  script: |
    source conda_env/bin/activate
    start-jupyter-notebook-and-register-address  # pseudocode

services:
  dask.scheduler:
    resources:
      memory: 2 GiB
      vcores: 1
    files:
      conda_env: env.tar.gz
    script: |
      source conda_env/bin/activate
      start-dask-scheduler-and-register-address  # pseudocode

  dask.worker:
    instances: 4
    resources:
      memory: 4 GiB
      vcores: 4
    max_restarts: 8  # Restart workers a maximum of 8 times
    files:
      conda_env: env.tar.gz
    depends:
      - dask.scheduler  # Ensure scheduler is started before workers
    script: |
      source conda_env/bin/activate
      get-dask-scheduler-address-and-start-worker  # pseudocode
</pre></div>
</div>
</div>
<div class="section" id="python-api-example">
<h2><a class="toc-backref" href="#id41">Python API Example</a><a class="headerlink" href="#python-api-example" title="Permalink to this headline">¶</a></h2>
<p>The above YAML file format is also composable using the <a class="reference external" href="api.html#application-specification">Python API</a>. The python classes
(<a class="reference internal" href="api.html#skein.ApplicationSpec" title="skein.ApplicationSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ApplicationSpec</span></code></a>, <a class="reference internal" href="api.html#skein.Service" title="skein.Service"><code class="xref py py-class docutils literal notranslate"><span class="pre">Service</span></code></a>, etc…) map 1:1 to the YAML format
described above. They can be read from a file, or created directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">skein</span>

<span class="c1"># Create from a yaml file</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">skein</span><span class="o">.</span><span class="n">ApplicationSpec</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;spec.yaml&#39;</span><span class="p">)</span>

<span class="c1"># Create directly</span>
<span class="n">jupyter</span> <span class="o">=</span> <span class="n">skein</span><span class="o">.</span><span class="n">Master</span><span class="p">(</span><span class="n">resources</span><span class="o">=</span><span class="n">skein</span><span class="o">.</span><span class="n">Resources</span><span class="p">(</span><span class="n">memory</span><span class="o">=</span><span class="s1">&#39;2 GiB&#39;</span><span class="p">,</span> <span class="n">vcores</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                       <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;conda_env&#39;</span><span class="p">:</span> <span class="s1">&#39;env.tar.gz&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;data.csv&#39;</span><span class="p">:</span> <span class="s1">&#39;hdfs:///path/to/some/data.csv&#39;</span><span class="p">},</span>
                       <span class="n">script</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;source conda_env/bin/activate</span><span class="se">\n</span><span class="s1">&#39;</span>
                               <span class="s1">&#39;start-jupyter-notebook-and-register-address&#39;</span><span class="p">))</span>

<span class="n">scheduler</span> <span class="o">=</span> <span class="n">skein</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="n">resources</span><span class="o">=</span><span class="n">skein</span><span class="o">.</span><span class="n">Resources</span><span class="p">(</span><span class="n">memory</span><span class="o">=</span><span class="s1">&#39;2 GiB&#39;</span><span class="p">,</span> <span class="n">vcores</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;conda_env&#39;</span><span class="p">:</span> <span class="s1">&#39;env.tar.gz&#39;</span><span class="p">},</span>
                          <span class="n">script</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;source conda_env/bin/activate</span><span class="se">\n</span><span class="s1">&#39;</span>
                                  <span class="s1">&#39;start-dask-scheduler-and-register-address&#39;</span><span class="p">))</span>

<span class="n">worker</span> <span class="o">=</span> <span class="n">skein</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="n">instances</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">max_restarts</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                       <span class="n">resources</span><span class="o">=</span><span class="n">skein</span><span class="o">.</span><span class="n">Resources</span><span class="p">(</span><span class="n">memory</span><span class="o">=</span><span class="s1">&#39;4 GiB&#39;</span><span class="p">,</span> <span class="n">vcores</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                       <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;conda_env&#39;</span><span class="p">:</span> <span class="s1">&#39;env.tar.gz&#39;</span><span class="p">},</span>
                       <span class="n">depends</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dask.scheduler&#39;</span><span class="p">],</span>
                       <span class="n">script</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;source conda_env/bin/activate</span><span class="se">\n</span><span class="s1">&#39;</span>
                               <span class="s1">&#39;get-dask-scheduler-address-and-start-worker&#39;</span><span class="p">))</span>

<span class="n">spec</span> <span class="o">=</span> <span class="n">skein</span><span class="o">.</span><span class="n">ApplicationSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;dask-with-jupyter&quot;</span><span class="p">,</span>
                             <span class="n">queue</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
                             <span class="n">master</span><span class="o">=</span><span class="n">jupyter</span><span class="p">,</span>
                             <span class="n">services</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dask.scheduler&#39;</span><span class="p">:</span> <span class="n">scheduler</span><span class="p">,</span>
                                       <span class="s1">&#39;dask.worker&#39;</span><span class="p">:</span> <span class="n">worker</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo.svg" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">A tool and library for easily deploying applications on Apache YARN</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jcrist&repo=skein&type=watch&count=False&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/jcrist/skein">
    <img
        alt="https://secure.travis-ci.org/jcrist/skein.svg?branch=master"
        src="https://secure.travis-ci.org/jcrist/skein.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#specification-components">Specification Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python-api-example">Python API Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="distributing-files.html">Distributing Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="key-value-store.html">Key-Value Store</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-ui.html">Web UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="develop.html">Development</a></li>
</ul>

<h3>Need help?</h3>

<p>
  Open an issue in the <a href="https://github.com/jcrist/skein/issues">issue tracker</a>.
</p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Jim Crist.
      
      |
      <a href="_sources/specification.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>